meta:
  id: core.trigger.webhook
  name: Webhook
  category: Triggers
  type: Trigger
  platform: core
  description: "Triggers when a specific URL is called."
  version: "1.0.0"

interface:
  inputs: []
  outputs:

    - name: Success
      type: flow

  settings:
    - name: method
      label: HTTP Method
      type: select
      default: POST
      options: ["GET", "POST", "PUT", "PATCH", "DELETE"]
    
    - name: path
      label: Webhook Path
      type: string
      description: "Unique path suffix (e.g. /my-hook)"
      required: true

    - name: webhook_url_test
      label: Test Webhook URL
      type: url
      read_only: true
      default: "{{ system.webhook_base }}/test/{{ workflow.id }}{{ settings.path }}"

    - name: webhook_url_prod
      label: Production Webhook URL
      type: url
      read_only: true
      default: "{{ system.webhook_base }}/prod/{{ workflow.id }}{{ settings.path }}"

execution:
  # Runner injects `event` containing body, headers, query
  - id: emit_body
    tool: emit
    params:
      port: body
      value: "{{ event.body }}"

  - id: emit_headers
    tool: emit
    params:
      port: headers
      value: "{{ event.headers }}"

  - id: emit_query
    tool: emit
    params:
      port: query
      value: "{{ event.query }}"

  - id: emit_exec
    tool: emit
    params:
      port: Success
